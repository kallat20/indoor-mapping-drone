<launch>
    <append_env name="GZ_SIM_RESOURCE_PATH" value="$(find-pkg-share drone_gazebo)" />
    <append_env name="GZ_SIM_RESOURCE_PATH" value="$(find-pkg-share drone_gazebo)/models" />

    <!-- world seçimi --> 
    <arg name="world" default="tugbot_depot.sdf" />

    <!-- Rviz-->  
    <arg name="use_rviz" default="true"/>

    <!-- Gazebo konak yolları -->
    <append_env name="GZ_SIM_RESOURCES_PATH" value="$(find-pkg-share drone_gazebo)/models" />

    <!-- Gazebo başlat -->
    <include file="$(find-pkg-share ros_gz_sim)/launch/gz_sim.launch.py">
    <arg name="gz_args" value="-r $(find-pkg-share drone_gazebo)/worlds/$(var world)" />
    </include>

    <!-- Drone modeli spawn et -->
    <node pkg="ros_gz_sim"
          exec="create"
          name="spawn_x500"
          output="screen"
          args="-name x500_lidar_2d
                -x 0 -y 0 -z 0.5
                -R 0 -P 0 -Y 0
                -file $(find-pkg-share drone_gazebo)/models/x500_lidar_2d/model.sdf" >
    </node>

    <!-- Bridges: Gazebo -> ROS2 -->
    <node pkg="ros_gz_bridge" exec="parameter_bridge" name="bridge_sensors" output="screen"
      args="
        /clock@rosgraph_msgs/msg/Clock[gz.msgs.Clock                      
        /scan@sensor_msgs/msg/LaserScan[gz.msgs.LaserScan                     
        /pi_camera/image_raw@sensor_msgs/msg/Image[gz.msgs.Image                  
        /pi_camera/camera_info@sensor_msgs/msg/CameraInfo[gz.msgs.CameraInfo      
      ">
    </node>

    <!-- TF bridge -->
    <node pkg="ros_gz_bridge" exec="parameter_bridge" name="bridge_tf" output="screen"
            args="/model/x500_lidar_2d/pose@tf2_msgs/msg/TFMessage[gz.msgs.Pose_V">
        <remap from="/model/x500_lidar_2d/pose" to="/tf"/>
    </node>

    <!-- Tf bağıntıları -->
    <node pkg="tf2_ros" exec="static_transform_publisher" name="tf_lidar"       
      args="0 0 0.07 0 0 0 base_link lidar_240_link --ros-args -p use_sim_time:=true"
      output="screen">
    </node>

    <node pkg="tf2_ros" exec="static_transform_publisher" name="tf_camera"
      args="0.15 0 0.03 0 0 0 base_link pi_camera_link --ros-args -p use_sim_time:=true"
      output="screen">
    </node>

    <!-- base_link x500_lidar_2d static tf bağlantısı-->
    <node pkg="tf2_ros" exec="static_transform_publisher" name="tf_base_to_model"
      args="0 0 0 0 0 0 base_link x500_lidar_2d --ros-args -p use_sim_time:=true"
      output="screen">
    </node> 

    <!-- RViz2 -->
    <node pkg="rviz2" exec="rviz2" name="rviz2" output="screen"
          args="-d $(find-pkg-share drone_bringup)/rviz/indoor_mapping.rviz">
      <param name="use_sim_time" value="true"/>
    </node>
</launch>